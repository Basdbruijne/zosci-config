- job:
    name: base
    pre-run: playbooks/base/pre.yaml
    post-run: playbooks/base/post.yaml
    roles:
      - zuul: zuul/zuul-jobs
    timeout: 1800
    nodeset:
      nodes:
        - name: bionic-small
          label: bionic-small
    secrets: &log_clouds
      - serverstack_cloud
- job:
    name: osci-lint
    description: "Run OSCI's lint task"
    parent: tox
    vars:
      tox_envlist: pep8

# - job:
#     name: charm-build
#     description: Build a source charm into a deployable charm
#     parent: tox
#     provides: charm
#     run: playbooks/charm/build.yaml

- job:
    name: juju-bootstrap
    description: Bootstrap a Juju controller on OpenStack
    parent: tox
    secrets:
      - serverstack_cloud
    run: playbooks/juju-bootstrap/run.yaml
    post-run: playbooks/juju-bootstrap/post.yaml

- job:
    name: func-target
    description: Run a functional test
    parent: juju-bootstrap
    attempts: 2
    # dependencies:
    #   - charm-build
    semaphore: functional-test
    # as an alternate to semaphores, or along side them, we could define
    # a custom node label to use for the func jobs. This would have a potential
    # advantage of allowing us to pre-bake in cloud credentials and such in
    # addition to other node preparation we could do (snap install juju,
    # juju add-cloud, etc)
    #
    # nodeset:
    #   nodes:
    #     - name: bionic-small
    #       label: bionic-small
    # requires: charm
    # queue: functional-test
    vars:
      tox_envlist: func-target

- job:
    name: bionic-queens
    description: Run a functional test against bionic-queens
    parent: func-target
    vars:
      tox_extra_args: bionic-queens
